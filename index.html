<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jogo da Forca</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f3f4f6;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        color: #222;
        text-align: center;
      }
      .container {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 700px;
      }
      .word {
        font-size: 28px;
        letter-spacing: 10px;
        text-align: center;
        margin: 20px 0;
      }
      .used {
        text-align: center;
        color: #555;
        margin-bottom: 10px;
      }
      .form input {
        width: 40px;
        text-align: center;
        font-size: 20px;
        padding: 5px;
      }
      .form button {
        padding: 8px 15px;
        margin-left: 5px;
      }
      .players {
        margin-top: 30px;
      }
      .player {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f9fafb;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 5px;
      }
      .selected {
        background: #dbeafe;
      }
      .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        text-align: center;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>ðŸŽ¯ Jogo da Forca</h1>
    <div class="container">
      <svg viewBox="0 0 120 140" width="180" height="200" id="forca"></svg>

      <div class="word" id="word"></div>
      <div class="used" id="usedLetters"></div>

      <form id="letterForm" class="form">
        <input type="text" id="letterInput" maxlength="1" placeholder="a" />
        <button type="submit">Enviar</button>
        <button type="button" id="reset">Reiniciar</button>
      </form>

      <p id="message" style="color: red; text-align: center;"></p>
      <p style="text-align: center;">Erros: <span id="wrongCount">0</span> / 6</p>

      <div class="players">
        <h2>Jogadores</h2>
        <div id="playerList"></div>

        <form id="addPlayerForm">
          <input type="text" id="playerName" placeholder="Nome do jogador" />
          <button type="submit">Adicionar</button>
        </form>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal hidden">
      <div class="modal-content">
        <h2 id="modalTitle"></h2>
        <p>PontuaÃ§Ã£o: <span id="modalScore"></span></p>
        <p>Digite seu nome:</p>
        <input type="text" id="winnerName" placeholder="Seu nome" />
        <button id="saveScore">Salvar pontuaÃ§Ã£o</button>
      </div>
    </div>

    <script>
      const WORDS = ["brasil", "computador", "javascript", "react", "amazon", "forca", "desenvolvedor", "estacao", "programa", "arvore"];
      const API_URL = "https://3ttz2ayos4.execute-api.us-east-1.amazonaws.com/v1/items";

      let secret = chooseWord();
      let guessed = [];
      let wrongCount = 0;
      let players = [];
      let currentPlayerId = null;
      let modalScore = 0;

      const wordDiv = document.getElementById("word");
      const usedLettersDiv = document.getElementById("usedLetters");
      const messageP = document.getElementById("message");
      const wrongCountSpan = document.getElementById("wrongCount");
      const playerListDiv = document.getElementById("playerList");
      const letterForm = document.getElementById("letterForm");
      const letterInput = document.getElementById("letterInput");
      const modal = document.getElementById("modal");
      const modalTitle = document.getElementById("modalTitle");
      const modalScoreSpan = document.getElementById("modalScore");
      const winnerNameInput = document.getElementById("winnerName");

      async function fetchPlayers() {
        try {
          const response = await fetch(API_URL);
          const data = await response.json();
          players = data;
          if (players.length > 0) currentPlayerId = players[0].id;
          renderPlayers();
        } catch (err) {
          console.error("Erro ao buscar jogadores:", err);
        }
      }

      function chooseWord() {
        return WORDS[Math.floor(Math.random() * WORDS.length)];
      }

      function renderWord() {
        wordDiv.textContent = secret.split("").map(l => (guessed.includes(l) ? l : "_")).join(" ");
      }

      function renderPlayers() {
        playerListDiv.innerHTML = "";
        players.forEach(p => {
          const div = document.createElement("div");
          div.className = "player" + (p.id === currentPlayerId ? " selected" : "");
          div.innerHTML = `
            <div>
              <strong>${p.nome}</strong><br />
              <small>ID: ${p.id}</small>
            </div>
            <div>
              <strong>${p.pontuacao}</strong>
              <div>
                <button onclick="selectPlayer(${p.id})">Selecionar</button>
                <button onclick="removePlayer(${p.id})">Remover</button>
              </div>
            </div>`;
          playerListDiv.appendChild(div);
        });
      }

      function selectPlayer(id) {
        currentPlayerId = id;
        renderPlayers();
      }

      function removePlayer(id) {
        players = players.filter(p => p.id !== id);
        if (currentPlayerId === id && players.length > 0) currentPlayerId = players[0].id;
        renderPlayers();
      }

      document.getElementById("addPlayerForm").addEventListener("submit", e => {
        e.preventDefault();
        const name = document.getElementById("playerName").value.trim();
        if (!name) return;
        const id = (players.reduce((m, p) => Math.max(m, p.id), 0) || 0) + 1;
        players.push({ id, nome: name, pontuacao: 0 });
        document.getElementById("playerName").value = "";
        renderPlayers();
      });

      letterForm.addEventListener("submit", e => {
        e.preventDefault();
        const val = letterInput.value.trim().toLowerCase();
        letterInput.value = "";
        if (!val.match(/^[a-zÃ£Ã¡Ã¢Ã Ã§Ã©ÃªÃ­Ã³Ã´ÃµÃºÃ¼]$/i)) {
          messageP.textContent = "Insira apenas 1 letra vÃ¡lida.";
          return;
        }
        if (guessed.includes(val)) {
          messageP.textContent = "Letra jÃ¡ utilizada.";
          return;
        }
        guessed.push(val);
        if (!secret.includes(val)) wrongCount++;
        updateGameState();
      });

      function updateGameState() {
        renderWord();
        usedLettersDiv.textContent = "Letras usadas: " + guessed.join(", ");
        wrongCountSpan.textContent = wrongCount;
        const won = secret.split("").every(l => guessed.includes(l));
        if (won) showModal(1);
        else if (wrongCount >= 6) showModal(0);
      }

      function showModal(score) {
        modal.classList.remove("hidden");
        modalTitle.textContent = score ? "ðŸŽ‰ VocÃª venceu!" : "ðŸ’€ Fim de jogo!";
        modalScore = score;
        modalScoreSpan.textContent = score;
      }

      document.getElementById("saveScore").addEventListener("click", () => {
        const nome = winnerNameInput.value.trim();
        if (!nome || !currentPlayerId) return;
        const player = players.find(p => p.id === currentPlayerId);
        player.nome = nome;
        player.pontuacao += modalScore;
        renderPlayers();
        modal.classList.add("hidden");
        resetGame();
      });

      document.getElementById("reset").addEventListener("click", resetGame);

      function resetGame() {
        secret = chooseWord();
        guessed = [];
        wrongCount = 0;
        messageP.textContent = "";
        updateGameState();
      }

      fetchPlayers();
      renderWord();
    </script>
  </body>
</html>
